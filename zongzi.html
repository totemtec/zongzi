<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>浓情端午，粽享好礼</title>
    <meta name="keywords" content="" />
	<meta name="description" content="" />
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,minimal-ui">
	<meta name="format-detection" content="telephone=no,address=no" />
	<meta name="referrer" content="always">
	<meta name="apple-mobile-web-app-capable" content="no" />
	<meta name="apple-mobile-web-app-status-bar-style" content="no" />
	<meta content="email=no" name="format-detection" />
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<link rel="stylesheet" href="css/m_main.css" />

	<script src="js/vconsole.min.js"></script>
	<script>
		// 初始化
		var vConsole = new VConsole();
	</script>
	
</head>
<body>
	<div class="mask" id="mask0" style="display:none;"></div>
	<div class="mask" id="mask1" style="display:none;"></div>
<!--分享弹窗开始-->
	<div class="sharetext" style="display:none;">
		<span></span>
		<p class="bs">集齐四种粽子，即可拆开礼盒获取好礼，快去呼唤好友帮你一把！</p>
	</div>
<!--分享弹窗结束-->
<!--关注公众号开始-->
	<div class="gzgzhbox" style="display:none;">
		<h2>关注“盛京银行”公众号<br/>参与活动</h2>
		<img src="images/wx.png"/>
		<h4>长按识别二维码</h4>
		<a class="closebtn">知道了</a>
	</div>
<!--关注公众号结束-->
<!--收集一枚粽子弹窗开始-->
	<div class="collectcg" style="display:none;" id="likeSuccess">
		<span class="closebtn">关闭</span>
		<div class="poupbox">
			<img src="images/tc_sjcg.png"/>
			<a class="linkbtn" id="wantPlayOnDialog">我也要参加</a>
		</div>
	</div>
<!--收集一枚粽子弹窗结束-->
<!--中奖了弹窗开始-->
	<div class="collectcg" style="display:none;" id="giftGoods">
		<span class="closebtn">关闭</span>
		<div class="poupbox">
			<img src="images/tc_zj.png"/>
			<a class="linkbtn" href="address.html" onclick="giftGoodsDismiss()">填写联系地址</a>
		</div>
	</div>
<!--中奖了弹窗结束-->
<!--中奖了视频会员卡弹窗开始-->
	<div class="collectcg" style="display:none;" id="giftCode">
		<span class="closebtn">关闭</span>
		<div class="poupbox">
			<img src="images/tc_sphyk.png"/>
			<a class="linkbtn" href="mygift.html" onclick="giftCodeDismiss()">查看激活码</a>
		</div>
	</div>
<!--中奖了视频会员卡弹窗结束-->
<!--重复领取礼品结束-->
<div class="collectcg" style="display:none;" id="duplicatedGift">
	<span class="closebtn">关闭</span>
	<div class="poupbox">
		<img src="images/tc_lingguole.png"/>
	</div>
</div>
<!--重复领取礼品结束-->
<!--重复助力弹窗开始-->
	<div class="collectcg" style="display:none;" id="duplacatedLike">
		<span class="closebtn">关闭</span>
		<div class="poupbox">
			<img src="images/tc_cfzl.png"/>
			<a class="linkbtn" id="wantPlayOnDialog2">我也要参加</a>
		</div>
	</div>
<!--重复助力弹窗结束-->
<!--未中奖弹窗开始-->
	<div class="collectcg" style="display:none;" id="giftNone">
		<span class="closebtn">关闭</span>
		<div class="poupbox">
			<img src="images/tc_wzj.png"/>
		</div>
	</div>
<!--未中奖弹窗结束-->
<!--未获得奖品弹窗开始-->
	<div class="collectcg" style="display:none;">
		<span class="closebtn">关闭</span>
		<div class="poupbox">
			<img src="images/tc_wjp.png"/>
		</div>
	</div>
<!--未获得奖品弹窗结束-->
	<section class="contentbox jzzbox">
		<div class="headbox">
			<span><img src="images/zz1.png" id="avatar"/></span>
			<p id="nickname">昵称</p>
		</div>
		<div class="mygift" style="display:none;" id="mygift">
			<a href="mygift.html">我的礼品</a>
		</div>
		<h2 class="titlesp" id="titleTips">全部集齐可以领取礼包</h2>
		<div class="giftpt"><img src="images/lwpt.png"/></div>
		<div class="zzbox">
			<span class="cfz" id="zongzi0">财富粽</span>
			<span class="jkz" id="zongzi1">健康粽</span>
			<span class="xfz" id="zongzi2">幸福粽</span>
			<span class="syz" id="zongzi3">事业粽</span>
		</div>
		<div class="fridebox">
			<ul>
				<li style="display: none;" id="user0">
					<span><img src="images/zz1.png" id="avatar0"/></span>
					<p class="userNickName" id="nickname0">好友昵称</p>
				</li>
				<li style="display: none;" id="user1">
					<span><img src="images/zz1.png" id="avatar1"/></span>
					<p class="userNickName" id="nickname1"></p>
				</li>
				<li style="display: none;" id="user2">
					<span><img src="images/zz1.png" id="avatar2"/></span>
					<p class="userNickName" id="nickname2"></p>
				</li>
				<li style="display: none;" id="user3">
					<span><img src="images/zz1.png" id="avatar3"/></span>
					<p class="userNickName" id="nickname3"></p>
				</li>
			</ul>
		</div>
		<h5 id="statusTips">邀请4位好友帮忙收集粽子可领取</h5>
		<a class="lqgiftbtn" id="play">找好友集粽子</a>
		<a class="lqgiftbtn" id="gift" style="display: none;">领取礼物</a>
		<a class="lqgiftbtn" id="like" style="display: none;">帮好友助力</a>
		<a class="lqgiftbtn" id="wantPlay" style="display: none;">我也要参与</a>
		<div class="rulebox bs">
			<h3>活动规则</h3>
			<p><span>1、</span>邀请4个好友助力收集粽子，集齐全部粽子即可拆开礼盒。</p>
			<p><span>2、</span>助力好友也可组局参与活动， 但参与活动需关注公众号。</p>
			<h4>[ 活动礼品 ]</h4>
			<p><span></span>娇韵诗化妆品礼盒 20个、<br/>视频会员月卡1000个</p>
			<h4>[ 活动时间 ] </h4>
			<p><span></span>2020年6月24日-6月28日</p>
		</div>
	</section>
<script type="text/javascript">
		//关闭分享弹窗
		$(".header .textbtn").click(function(){
			$(".sharetext").fadeOut();
			$(".mask").fadeOut();
		})

		$("#mask0").click(function(){
			$(".sharetext").fadeOut();
			$(".mask").fadeOut();
			$("#duplicatedGift").fadeOut();
		})

		//关闭公众号弹窗
		$(".gzgzhbox .closebtn").click(function(){

			shareKey = getQueryString('uk');
			refreshUserInfo(shareKey);

			$(".gzgzhbox").fadeOut();
			$("#mask1").fadeOut();
		})

		//关闭弹窗
		$(".collectcg .closebtn").click(function(){
			$(".collectcg").fadeOut();
			$(".mask").fadeOut();
		})

		$("#play").click(function(){
			let user  = getUser();
			if (user && user.subscribe == 0) {
				$(".gzgzhbox").fadeIn();
				$("#mask1").fadeIn();
			} else {
				$(".sharetext").fadeIn();
				$("#mask0").fadeIn();
			}
		});

		$("#wantPlayOnDialog").click(function(){
			window.location.assign('https://wxsp.totemtec.com/zongzi.html');
		});
		$("#wantPlayOnDialog2").click(function(){
			window.location.assign('https://wxsp.totemtec.com/zongzi.html');
		});

		$("#wantPlay").click(function(){
			let user  = getUser();
			if (user && user.subscribe == 0) {
				$(".gzgzhbox").fadeIn();
				$("#mask1").fadeIn();
			} else {
				window.location.assign('https://wxsp.totemtec.com/zongzi.html');
			}
		});

		$("#like").click(function(){
			// let user  = getUser();
			// if (user==null || user.subscribe == 0) {
			// 	$(".gzgzhbox").fadeIn();
			// 	$("#mask1").fadeIn();
			// 	return;
			// }

			shareKey = getQueryString('uk');
		
			likeShareUser(shareKey);
		});

		$("#duplacatedLike closebtn").click(function(){
			$('#duplacatedLike').fadeOut();
			$('#mask1').fadeOut();
		});

		$("#gift").click(function(){
			gameLucky();
		});
		
		$("#playGame").click(function(){
			$('#likeSuccess').fadeOut();
			$('#mask1').fadeOut();
			setTimeout(function(){ 
				window.location.assign('https://wxsp.totemtec.com/zongzi.html');
			}, 1000);
		});

		function showGift(gift) {
			//未中奖
			if (gift.status == 0) {
				$('#giftNone').fadeIn();
				$('#mask1').fadeIn();
			} else if(gift.duplicated) {
				$('#duplicatedGift').fadeIn();
				$('#mask0').fadeIn();
				$('#mygift').css('display', 'block');
			} else {
				$('#mygift').css('display', 'block');
				if (gift.packageType == 1) {
					//虚拟礼品
					$('#giftCode').fadeIn();
					$('#mask1').fadeIn();
				} else if (gift.packageType == 2) {
					//实物礼品
					$('#giftGoods').fadeIn();
					$('#mask1').fadeIn();
				}
			}
		}
	function gameLucky() {

		let user = getUser();
		if (user && user.userGift) {
			if (user.userGift.status == 0) {
				$('#giftNone').fadeIn();
				$('.mask').fadeIn();
			} else {
				$('#duplicatedGift').fadeIn();
				$('mask').fadeIn();
			}
			
			return;
		}

		let url = 'https://wxspapi.totemtec.com/game/lucky';

		$.getJSON(url, function (res) {
			if (res.code == 1 && res.data) {
				showGift(res.data);
			}
		});
	}

	function giftGoodsDismiss() {
		$('#giftGoods').css('display', 'none');
		$('.mask').css('display', 'none');
	}

	function giftCodeDismiss() {
		$('#giftCode').css('display', 'none');
		$('.mask').css('display', 'none');
	}


	</script>

<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js"></script>

<script type="text/javascript" src="js/global.js"></script>

<script type="text/javascript" src="js/wechat.js" ></script>


<script type="text/javascript">

const zongziPage = true;

function showGameData(user) {
	$('#avatar').attr("src", user.avatar);
	$('#nickname').text(user.nickName);

	let likeList = user.likeList;
	if (likeList.length > 0) {
		let user0 = likeList[0];
		$('#zongzi0').addClass('active');
		$('#user0').css('display','block');
		$('#avatar0').attr("src", user0.avatar);
		$('#nickname0').text(user0.nickName)
	}

	if (likeList.length > 1) {
		let user1 = likeList[1];
		$('#zongzi1').addClass('active');
		$('#user1').css('display','block');
		$('#avatar1').attr("src", user1.avatar);
		$('#nickname1').text(user1.nickName)
	}

	if (likeList.length > 2) {
		let user2 = likeList[2];
		$('#zongzi2').addClass('active');
		$('#user2').css('display','block');
		$('#avatar2').attr("src", user2.avatar);
		$('#nickname2').text(user2.nickName)
	}

	if (likeList.length > 3) {
		let user3 = likeList[3];
		$('#zongzi3').addClass('active');
		$('#user3').css('display','block');
		$('#avatar3').attr("src", user3.avatar);
		$('#nickname3').text(user3.nickName)
	}
}

function showUserInfo(user) {
	$("#like").css('display','none');
	$("#titleTips").text('全部集齐可以领取礼包');

	if(user.userGift && user.userGift.status > 0) {
		$("#mygift").css('display','block');
	} else {
		$("#mygift").css('display','none');
	}

	if (user.likeList.length >= 4) {
		$("#play").css('display','none');
		$("#gift").css('display','block');
		
		$("#statusTips").text("恭喜您集齐了4个粽子，可以领取礼品啦");
	} else {
		$("#play").css('display','block');
		$("#gift").css('display','none');
		$("#mygift").css('display','none');
	}

	showGameData(user);
}

function showShareUserInfo(shareUser) {

	
	$("#play").css('display','none'); 
	$("#gift").css('display','none'); 
	$("#mygift").css('display','none');
	$("#titleTips").text('邀您助力集粽子领礼品');

	let likeCount = shareUser.likeList.length;
	if (likeCount >= 4) {
		$("#statusTips").text("您的好友集齐了4个粽子！可以领取礼品啦");
		$("#wantPlay").css('display','block');
		$("#like").css('display','none');
	} else {
		let remain = 4 - likeCount;
		$("#statusTips").text("您的好友还差" + remain + "个粽子就能领取礼品");
		$("#like").css('display','block');
	}

	showGameData(shareUser);
}

function showLikeSuccess(shareUser) {
	$('#likeSuccess').fadeIn();
	$('#mask1').fadeIn();

	showShareUserInfo(shareUser);
}

function showLikeFailure(res) {
	if (res.code == 1018) {
		$('#duplacatedLike').fadeIn();
	    $('#mask1').fadeIn();
	} else {
		alert(res.message);
	}
}

   
</script>
</body>
</html>